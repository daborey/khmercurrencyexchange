<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Currency Rates</title>
</head>
<body>
    <h2>Update Exchange Rates</h2>

    <form id="updateForm">
        <!-- ABA -->
        <h3>ABA</h3>
        <label for="aba_buy">Buy Rate:</label>
        <input type="number" id="aba_buy" required>
        <label for="aba_sell">Sell Rate:</label>
        <input type="number" id="aba_sell" required>
        
        <br><br>

        <!-- ACELEDA -->
        <h3>ACELEDA</h3>
        <label for="ace_buy">Buy Rate:</label>
        <input type="number" id="ace_buy" required>
        <label for="ace_sell">Sell Rate:</label>
        <input type="number" id="ace_sell" required>
        
        <br><br>

        <!-- WING -->
        <h3>WING</h3>
        <label for="wing_buy">Buy Rate:</label>
        <input type="number" id="wing_buy" required>
        <label for="wing_sell">Sell Rate:</label>
        <input type="number" id="wing_sell" required>

        <br><br>
        <button type="button" id="updateButton">Update Rates</button>
    </form>

    <script>
        const updateButton = document.getElementById('updateButton');

        updateButton.addEventListener('click', function() {
            // Get the values from the form fields
            const abaBuy = document.getElementById('aba_buy').value;
            const abaSell = document.getElementById('aba_sell').value;

            const aceBuy = document.getElementById('ace_buy').value;
            const aceSell = document.getElementById('ace_sell').value;

            const wingBuy = document.getElementById('wing_buy').value;
            const wingSell = document.getElementById('wing_sell').value;

            // Validate all fields
            if (!abaBuy || !abaSell || !aceBuy || !aceSell || !wingBuy || !wingSell) {
                alert('Please fill in all the fields.');
                return;
            }

            // URL for triggering the GitHub Action workflow
            const url = 'https://api.github.com/repos/daborey/khmercurrencyexchange/actions/workflows/main.yml/dispatches';
            const token = 'YOUR_DB_TOKEN'; // Replace with your token using environment variables or secure methods

            const payload = {
                "ref": "main", // Reference to the main branch
                "inputs": {
                    "aba_buy": abaBuy,
                    "aba_sell": abaSell,
                    "ace_buy": aceBuy,
                    "ace_sell": aceSell,
                    "wing_buy": wingBuy,
                    "wing_sell": wingSell
                }
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Accept': 'application/vnd.github.v3+json',
                    'Authorization': `token ${token}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                alert('Exchange rates updated!');
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('Error updating exchange rates.');
            });
        });
    </script>
</body>
</html>
